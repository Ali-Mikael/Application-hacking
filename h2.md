# Break & Unbreak

# Task X) Summary
> Read/watch/listen and summarize     

## X.1) Broken access control
> OWASP Top 10: <https://owasp.org/Top10/2021/A01_2021-Broken_Access_Control/index.html> (link added 21.1.2026)     
> Note: I have abbreviated _Access Control_ to _AC_ in some instances!     

**A01:2021 - Broken Access Control**     
- Common AC vulnerabilites
  - Principle of least privilege violation.
  - Bypassing AC checks by tampering with the URL, internal app state, the HTML page or API requests
  - Insicure direct object references, meaning someone is able to view or edit another account by providing it's unique identifier.
  - API access with missing AC for POST
  - Privilege elevation
  - Metadata manipulation
  - CORS misconfiguration

**How to prevent?**
- Deny by default / principle of least privilege
- Implement AC mechanisms once, and re-use through application
- Disable web server directory listing and make sure file metadata and backup files are not present within web roots
- Log AC failures and implement alerts
- API rate limiting     


## X.2) Fuzzing
> Find Hidden Web Directories - Fuzz URLs with ffuf <https://terokarvinen.com/2023/fuzz-urls-find-hidden-directories/> (link added 21.1.2026)

**Background:**
- Web servers often have non-linked secret directories
- You could try finding them manually by typing all the possibilities, but `fuff` can do it automatically!
- Fuff is a web fuzzer, created by [joohoi](<https://github.com/joohoi>)

**Get fuzzing**
- Easy to install: `$ sudo apt-get install ffuf`
- The tool is installed, still need a wordlist/dictionary. For example: <https://github.com/danielmiessler/SecLists>
- Then specify wordlist and target and get going:
  - `$ ./ffuf -w common.txt -u http://<target>/FUZZ`
  - `-w` flag for **wordlist**
  - `-u` flag for **target url**
- Helpful:
  - `./fuff ` gives you params and filters to use with the tool     


## X.3) AC vulns and privilege escalation
> <https://portswigger.net/web-security/access-control> (link added: 21.1.2026)

**What is Access Control?**
- Put simply, it answers two questions, **who?** && **what?**
  - "_What actions_ is an _entity X_ allowed to take?"d

**Vertical AC**
- Restrict access to sensitive _functionality_ to specific type of users

**Horizontal AC**
- Restricts access to _resources_ to specific users

**Context-dependent AC**
- Restrict access to functionality and resources _based upon the state of the application, or the user's interaction with it_

**Note:**
- The rest of the article gives examples on common vulnerabilities and broken AC
- Check the task `X.1` above for that!


## X.4) Writing reports
> A guide for writing technical reports     
> <https://terokarvinen.com/2006/raportin-kirjoittaminen-4/> (link added: 21.1.2026)     

**The meat and bone:**
- **Repeatability & Clarity**
  - Write everything down as clearly as you can, so that somebody following along (doing everything you did), can arrive at the same exact outcome
  - This may include, but not limited to:
    - Computer specs
    - Environment
    - Timestamps
    - Internet connection
    - etc..
  - Also remember to report on any failures and unexpected stuff!
  - Remember to include troubleshooting methods/steps
- **Easy to read**
  - Use clear language and check spelling
  - Use headings
  - Write just enough, don't be tedious!
- **Always reference any material you use!**


**The no-no zone:**
- Straight up lying
- Plagiarisation     


# Specs 
**HOST**
- Lenovo ThinkPad L490
  - CPU: Intel i3-8145U (4) @ 3.900GHz 
  - GPU: Intel WhiskeyLake-U GT2 UHD Graphics 620
  - Total Memory: 8GB
  - Total Disk size: 256GB
  - OS: Ubuntu 24.04.3 LTS x86_64
  - Kernel: 6.8.0-90-generic
- Running the VM: KVM/QEMU Standard PC (Q35 + ICH9, 2009) (pc-q35-8.2)
- Managed by: Virtual Machine Manager v.4.1.0, powered by libvirt.

**VM**
- OS: Kali GNU/Linux Rolling x86_64
- Kernel: Linux 6.18.5+kali-amd64
- Total Memory: 4GB
- Total Disk size: 28GB     


  
# A) Break-in and enter
> Objective:     
> Break into 010-staff-only     
> Reveal admin password. (It contains the string "SUPERADMIN")        
> <https://terokarvinen.com/hack-n-fix/> (link added: 21.1.2026)      

## Setting up
It all began with the command:
```bash
$ mkdir terosChallenge && cd terosChallenge && wget https://terokarvinen.com/hack-n-fix/teros-challenges.zip
```
- This creates a directory, moves into it and downloads the necessities      
We can then decompress the contents:
```bash
$ unzip teros-challenges.zip
```    
We get a new directory containing the challenge:
- <img width="606" height="341" alt="Screenshot from 2026-01-22 18-03-00" src="https://github.com/user-attachments/assets/73b62eb8-1848-40c1-af31-983217299204" />     

We then start the challenge by running `$ ./staff-only.py` and paste the address we're given into a browser
- <img width="1073" height="146" alt="Screenshot from 2026-01-22 18-07-50" src="https://github.com/user-attachments/assets/9af4193b-72a6-49f9-8051-7c64f4fb4452" />
- <img width="578" height="378" alt="Screenshot from 2026-01-22 18-09-25" src="https://github.com/user-attachments/assets/c1f3a805-7e78-46ba-8571-274889e92e96" />     

## Walkthrough
By typing in the pin code found at the bottom of the page (123), we're able to recover our password
- <img width="992" height="326" alt="Screenshot from 2026-01-22 18-50-40" src="https://github.com/user-attachments/assets/3fb716d3-3b98-48d3-a6ed-b08697fc937c" />     

The website is kind enough to let us know the SQL query used to recover it, which is: 
```sql
SELECT password FROM pins WHERE pin='<input>';
```
So I tried to inject it by typing 
```sql
' OR 1=1--
``` 
into the input field:
- <img width="975" height="259" alt="Screenshot from 2026-01-22 18-32-36" src="https://github.com/user-attachments/assets/e9ed4b6d-96cf-4b0d-ad70-9771be2c7034" />
- But it throws an error "Please enter a number.", so we have to try something else..     

**Try #2:**
- I inspected the html page through the developer tools, and found a form field with `input type="number"`, so I changed it to `type="string"` and ran the same injection again
  - <img width="483" height="312" alt="Screenshot from 2026-01-22 18-47-36" src="https://github.com/user-attachments/assets/26f39074-6a72-48ea-b0d5-5bbb7babd497" />
- This time around, we got a different answer:
  - <img width="620" height="169" alt="Screenshot from 2026-01-22 18-47-52" src="https://github.com/user-attachments/assets/0b212682-df7a-428c-9372-8de2c4f97429" />
- Only problem is, foo is not the one we're looking for...     


**Try #3:**
- My Next attempt was trying to crack it from the command line, and I found a super useful website explaining how to use `curl` to to a POST request
  - Link: <https://reqbin.com/req/c-g5d14cew/curl-post-example>
- So from the CLI the command looks like this:

```bash
$ curl -X POST http://127.0.0.1:5000 -H "Content-Type: application/x-www-form-urlencoded" -d "pin=' OR 1=1--"
```
But we're still only getting a `foo` response from the server...
- <img width="1209" height="303" alt="Screenshot from 2026-01-23 15-22-58" src="https://github.com/user-attachments/assets/771836c2-7892-4d13-8653-4624103c7e12" />     

**Try #4:**     
I'm pretty sure you have to circumvent the client-side validation, and to perform an injection attack, so I kept trying to change the input field type. (Which I later found out doesn't matter as long as you're able to input a string..)     

I once again went back to the web page, opened up the developer tool and changed the `type` to `= nvarchar`. I then typed in the injection:
```sql
' OR 1=1--
```
<img width="703" height="558" alt="Screenshot from 2026-01-23 16-11-45" src="https://github.com/user-attachments/assets/938a4ad5-2811-4201-8a95-f2b150388aa2" />       
Still only giving us "foo".....     

I also tried another variation of the attack like so:
```sql
' OR '1=1
```
Because we know the query, we can simply add an apostrophe before the 1, and leave the comment character out, as it will close the quote for us.     
But still nothin....      
<img width="703" height="558" alt="Screenshot from 2026-01-23 16-16-20" src="https://github.com/user-attachments/assets/730a4ce5-7cd2-4258-b3bd-e76b6cfc829b" />     
I also tried different combinations of input types, but i'm only getting `foo` in return.    
Though before accepting defeat, I checked what the tip section is saying (linked in the assigment):     
<img width="797" height="940" alt="Screenshot from 2026-01-23 16-23-57" src="https://github.com/user-attachments/assets/7d64f5f3-fab2-481d-86cf-97c35359e593" />     
Apparently i'm very close, but something is not clicking for me right now, so i'll come back to this!     

# (Took a 40min lunch break....)

After a well deserved break I came back to the computer feeling fresh, and finally internalised the fact that the injected query is always going to be true, so it's just delivering us the first match from the table. I needed a way to filter it somehow. The tip section pushed me in the right direction, but only when I took the break was I able to internalise this. (Reminder: take breaks! ðŸ˜ƒ)      
As we also learned from reading the tips, you could use the `LIMIT` operator, but that would require some manual labour, and I want to get straight to the sauce, so here we go:     

## Try #5
I searched online on how to filter the response and was going through some SQL syntax, I tried a few things, and finally found something that worked:
```sql
' UNION SELECT pin || '=' || password FROM pins WHERE password LIKE "%ADMIN%"--
```
<img width="1113" height="554" alt="Screenshot from 2026-01-23 23-09-19" src="https://github.com/user-attachments/assets/a61fd145-c96d-4af5-952d-5ce94d149a7f" />     
### Explanation:
The `UNION` operator allows me to create a new query, where I join together the pin and password.     
I then filter the result with the `LIKE` operator and use a simple regex (which only works because we know the string contains ADMIN, BTW).     

This results in me being the new owner of the `pin` and corresponding `password` for the `admin` user.     

# B) Fixing from source

